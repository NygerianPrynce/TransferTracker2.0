{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Search - Transfer Tracker</title>
    <meta
      name="description"
      content="Track Soccer Transfers Across The World and Never Miss Out Again!"
    />
    <meta property="og:title" content="Search - Transfer Tracker" />
    <meta
      property="og:description"
      content="Track Soccer Transfers Across The World and Never Miss Out Again!"
    />
    <meta
      property="og:image"
      content="https://aheioqhobo.cloudimg.io/v7/_playground-bucket-v2.teleporthq.io_/377e84b2-e699-4e3a-976f-a36d7c0af547/6e6b6b1b-cb17-4cbc-91c1-f870a2de3a52?org_if_sml=1"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta property="twitter:card" content="summary_large_image" />

    <style data-tag="reset-style-sheet">
      html {  line-height: 1.15;}body {  margin: 0;}* {  box-sizing: border-box;  border-width: 0;  border-style: solid;}p,li,ul,pre,div,h1,h2,h3,h4,h5,h6,figure,blockquote,figcaption {  margin: 0;  padding: 0;}button {  background-color: transparent;}button,input,optgroup,select,textarea {  font-family: inherit;  font-size: 100%;  line-height: 1.15;  margin: 0;}button,select {  text-transform: none;}button,[type="button"],[type="reset"],[type="submit"] {  -webkit-appearance: button;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner {  border-style: none;  padding: 0;}button:-moz-focus,[type="button"]:-moz-focus,[type="reset"]:-moz-focus,[type="submit"]:-moz-focus {  outline: 1px dotted ButtonText;}a {  color: inherit;  text-decoration: inherit;}input {  padding: 2px 4px;}img {  display: block;}html { scroll-behavior: smooth  }
    </style>
    <style data-tag="default-style-sheet">
      html {
        font-family: Poppins;
        font-size: 16px;
      }

      body {
        font-weight: 400;
        font-style:normal;
        text-decoration: none;
        text-transform: none;
        letter-spacing: normal;
        line-height: 1.15;
        color: var(--dl-color-gray-black);
        background-color: var(--dl-color-gray-white);

      }
    </style>
    <link
      rel="shortcut icon"
      href = "{% static 'logo21-1500h (1).png' %}"
      type="icon/png"
      sizes="32x32"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Oxygen:wght@300;400;700&amp;display=swap"
      data-tag="font"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap"
      data-tag="font"
    />
    <style>
      @keyframes fade-in-left {
        0% {
          opacity: 0;
          transform: translateX(-20px);
        }
        100% {
          opacity: 1;
          transform: translateX(0);
        }
      }
    </style>
    <style>
      [data-thq="thq-dropdown"]:hover > [data-thq="thq-dropdown-list"] {
          display: flex;
        }

        [data-thq="thq-dropdown"]:hover > div [data-thq="thq-dropdown-arrow"] {
          transform: rotate(90deg);
        }
    </style>
    <link href="{% static 'style.css'%}"  rel="stylesheet" />
  </head>
  <body>
    <div>
      <link href="{% static 'profile.css'%}"  rel="stylesheet" />

      <div class="search-container">
        <header data-thq="thq-navbar" class="search-navbar">
          <div class="search-container1">
            <div class="search-left">
              <a
              href="{% url 'home' %}"
              rel="noreferrer noopener"
              class="index-link"
              >
              <img
                alt="image"
                src="{% static 'logo2-1500h.png'%}"
                class="search-logo"
              />
            </div>
          </div>
          <div data-thq="thq-navbar-btn-group" class="search-right">
            <nav class="search-links">
              <a href="{% url 'home' %}" class="search-link">
                <span>HOME</span>
                <br />
              </a>
              <a href="{% url 'daily_transfers' %}" class="search-link01">
                <span>DAILY TRANSFERS</span>
                <br />
              </a>
              <a href="{% url 'watchlist' %}" class="search-link01">
                <span>MY WATCHLIST</span>
                <br />
              </a>
              <a href="{% url 'player_search' %}" class="search-link03">
                <span class="home-text04">SEARCH</span>
                <br />
              </a>
              <div
                data-thq="thq-dropdown"
                class="search-thq-dropdown list-item"
              >
                <div
                  data-thq="thq-dropdown-toggle"
                  class="search-dropdown-toggle"
                >
                  <span class="search-text06">ACCOUNT</span>
                  <div
                    data-thq="thq-dropdown-arrow"
                    class="search-dropdown-arrow"
                  >
                    <svg viewBox="0 0 1024 1024" class="search-icon">
                      <path d="M298 426h428l-214 214z"></path>
                    </svg>
                  </div>
                </div>
                <ul data-thq="thq-dropdown-list" class="search-dropdown-list">
                  <li data-thq="thq-dropdown" class="search-dropdown list-item">
                    <div
                      data-thq="thq-dropdown-toggle"
                      class="search-dropdown-toggle1"
                    >
                    <a href="{% url 'profile' %}" class="home-link02">
                      <span class="home-text07">PROFILE</span>
                      <br />
                    </a>                
                      </div>
                  </li>
                  <li
                    data-thq="thq-dropdown"
                    class="search-dropdown1 list-item"
                  >
                    <div
                      data-thq="thq-dropdown-toggle"
                      class="search-dropdown-toggle2"
                    >
                    <a href="{% url 'logout' %}" class="home-link02">
                      <span class="home-text08">LOG OUT</span>
                      <br />
                    </a>                    </div>
                  </li>
                </ul>
              </div>
            </nav>
          </div>
          <div data-thq="thq-burger-menu" class="search-burger-menu">
            <svg viewBox="0 0 1024 1024" class="search-icon02">
              <path
                d="M128 554.667h768c23.552 0 42.667-19.115 42.667-42.667s-19.115-42.667-42.667-42.667h-768c-23.552 0-42.667 19.115-42.667 42.667s19.115 42.667 42.667 42.667zM128 298.667h768c23.552 0 42.667-19.115 42.667-42.667s-19.115-42.667-42.667-42.667h-768c-23.552 0-42.667 19.115-42.667 42.667s19.115 42.667 42.667 42.667zM128 810.667h768c23.552 0 42.667-19.115 42.667-42.667s-19.115-42.667-42.667-42.667h-768c-23.552 0-42.667 19.115-42.667 42.667s19.115 42.667 42.667 42.667z"
              ></path>
            </svg>
          </div>
          <div data-thq="thq-mobile-menu" class="search-mobile-menu">
            <div
              data-thq="thq-mobile-menu-nav"
              data-role="Nav"
              class="search-nav"
            >
              <div class="search-container2">
                <img
                  alt="image"
                  src="{% static 'logo2-1500h.png'%}"
                  class="search-image"
                />
                <div data-thq="thq-close-menu" class="search-menu-close">
                  <svg viewBox="0 0 1024 1024" class="search-icon04">
                    <path
                      d="M810 274l-238 238 238 238-60 60-238-238-238 238-60-60 238-238-238-238 60-60 238 238 238-238z"
                    ></path>
                  </svg>
                </div>
              </div>
              <nav
                data-thq="thq-mobile-menu-nav-links"
                data-role="Nav"
                class="search-nav1"
              >
                <a
                href="{% url 'home' %}"
                  
                  rel="noreferrer noopener"
                  class="search-link04"
                >
                  HOME
                </a>
                <a
                href="{% url 'daily_transfers' %}"
                  rel="noreferrer noopener"
                  class="search-link05"
                >
                  DAILY TRANSFERS
                </a>
                <a
                href="{% url 'watchlist' %}"
                  rel="noreferrer noopener"
                  class="search-link06"
                >
                  MY WATCHLIST
                </a>
                <a
                href="{% url 'player_search' %}"
                  rel="noreferrer noopener"
                  class="search-link07"
                >
                  SEARCH
                </a>
                <a
                href="{% url 'profile' %}"
                  rel="noreferrer noopener"
                  class="search-link08"
                >
                  PROFILE
                </a>
                <a
                href="{% url 'logout' %}"
                  rel="noreferrer noopener"
                  class="search-link09"
                >
                  LOG OUT
                </a>
              </nav>
            </div>
          </div>
        </header>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<div class="container-xl px-4 mt-4 align-items-center justify-content-center" style="min-height: 100vh;">
    <div class="row align-items-center justify-content-center">
        <div class="col-xl-6">
            <!-- Account details card-->
            <div class="card mb-4">
                <div class="card-header">Account Details</div>
                <div class="card-body">
                  <form id="profile-form">
                    <div class="mb-3">
                      <label>Notification Preferences:</label>
                      <div class="form-check">
                          <input type="checkbox" class="form-check-input" id="emailNotifications" name="emailNotifications">
                          <label class="form-check-label" for="emailNotifications">Receive Email Notifications</label>
                      </div>
                      <div class="form-check">
                          <input type="checkbox" class="form-check-input" id="phoneNotifications" name="phoneNotifications">
                          <label class="form-check-label" for="phoneNotifications">Receive Phone Notifications</label>
                      </div>
                  </div>

                    <a href="{% url 'password_change' %}" class="btn btn-warning ">Change Password</a>
                    
            </form>
            <script>
              
              function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

              var user_id = "{{ user_id }}";
              const emailNotificationsCheckbox = document.getElementById("emailNotifications");
              const phoneNotificationsCheckbox = document.getElementById("phoneNotifications");
          

              async function fetchData() {
                try {
                  const response = await fetch("{% static 'info.csv' %}");
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const csvContent = await response.text();

                // Now you can work with the CSV content
                const lines = csvContent.trim().split('\n');
                if (user_id <= lines.length) {
                    
                    const user = lines[user_id].split('|');
                    

                    // Assuming user[3] and user[8] represent email and phone preferences
                    

                    // Set the checkboxes based on user preferences


                    emailNotificationsCheckbox.checked = user[3] === 'True'; // Assuming '1' represents enabled
                    phoneNotificationsCheckbox.checked = user[8] === 'True'; // Assuming '1' represents enabled

                } else {
                    console.error('User not found in the CSV.');
                }
                } catch (error) {
                  console.error('Error:', error);
                }
              }
              
              // Call the async function
              fetchData();

          
              emailNotificationsCheckbox.addEventListener("change", async () => {
                try {
                  const response = await fetch("{% static 'info.csv' %}");
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const csvContent = await response.text();

                // Now you can work with the CSV content
                const lines = csvContent.trim().split('\n');
                if (user_id <= lines.length) {
                    
                    const user = lines[user_id].split('|');
                    if (emailNotificationsCheckbox.checked) {
                      user[3] = "True";
                      console.log("User has enabled email notifications.");
                  } else {
                      user[3] = "False";
                      console.log("User has disabled email notifications.");
                  }

                  lines[user_id] = user.join('|');
                        const modifiedCSV = lines.join('\n');

                                fetch("{% url 'update_csv_file' %}", {
                                  method: 'POST',
                                  headers: {
                                      'Content-Type': 'application/x-www-form-urlencoded',
                                      'X-CSRFToken': getCookie('csrftoken')  // Include CSRF token
                                  },
                                  body: `modifiedCSV=${encodeURIComponent(modifiedCSV)}`
                              })
                              .then(response => {
                                  if (!response.ok) {
                                      throw new Error('Network response was not ok');
                                  }
                              })
                              .catch(error => {
                                  console.error('There was a problem updating the CSV file:', error);
                              });
                    // Set the checkboxes based on user preferences

                } else {
                    console.error('User not found in the CSV.');
                }
              } catch (error) {
                console.error('Error:', error);
              }
                  
              });
          
              phoneNotificationsCheckbox.addEventListener("change", async () => {
                try {
                  const response = await fetch("{% static 'info.csv' %}");
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const csvContent = await response.text();

                // Now you can work with the CSV content
                const lines = csvContent.trim().split('\n');
                if (user_id <= lines.length) {
                    
                    const user = lines[user_id].split('|');
                    

                  
                    if (phoneNotificationsCheckbox.checked) {
                      user[8] = "True";
                      console.log("User has enabled email notifications.");
                  } else {
                      user[8] = "False";
                      console.log("User has disabled email notifications.");
                  }

                  lines[user_id] = user.join('|');
                        const modifiedCSV = lines.join('\n');

                                fetch("{% url 'update_csv_file' %}", {
                                  method: 'POST',
                                  headers: {
                                      'Content-Type': 'application/x-www-form-urlencoded',
                                      'X-CSRFToken': getCookie('csrftoken')  // Include CSRF token
                                  },
                                  body: `modifiedCSV=${encodeURIComponent(modifiedCSV)}`
                              })
                              .then(response => {
                                  if (!response.ok) {
                                      throw new Error('Network response was not ok');
                                  }
                              })
                              .catch(error => {
                                  console.error('There was a problem updating the CSV file:', error);
                              });
                    // Set the checkboxes based on user preferences

                } else {
                    console.error('User not found in the CSV.');
                }
              } catch (error) {
                console.error('Error:', error);
              }
                  if (phoneNotificationsCheckbox.checked) {
                      console.log("User has enabled phone notifications.");
                  } else {
                      console.log("User has disabled phone notifications.");
                  }
              });
          </script>
                    
                </div>
            </div>
        </div>
    </div>
</div>
